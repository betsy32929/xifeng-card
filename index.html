<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ææ¥“å°ˆå±¬é›†é»å¡</title>
  <style>
    body { font-family: "Microsoft JhengHei", sans-serif; text-align: center; background: #fff9e6; margin: 0; padding: 20px; }
    h1 { color: #ff9800; }

    #status { font-size: 22px; margin: 10px 0; color: #333; }

    /* å¤§è§’è‰²æŒ‰éˆ•æ¨£å¼ï¼šæ­£æ–¹å½¢ */
    .buttonGrid {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 12px;
      max-width: 340px;
      margin: 0 auto 20px;
    }
    .charBtn {
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      background-color: #ffcc80;
      border: none;
      border-radius: 12px;
      font-size: 28px;
      font-weight: bold;
      cursor: pointer;
      box-shadow: 2px 2px 6px rgba(0,0,0,0.2);
      width: 150px;
      height: 150px;
    }
    .charBtn img {
      width: 70px;
      height: 70px;
      margin-top: 8px;
    }

    #removePointBtn, #redeemBtn, #resetBtn {
      font-size: 22px; 
      padding: 12px 20px; 
      border: none; 
      border-radius: 10px; 
      cursor: pointer; 
      margin: 5px; 
      box-shadow: 2px 2px 5px rgba(0,0,0,0.2);
    }
    #removePointBtn { background-color: #ff9999; }
    #redeemBtn { background-color: #ffc0cb; }
    #resetBtn { background-color: #d3d3d3; }

    .points { 
      display: grid; 
      grid-template-columns: repeat(5, 70px); 
      justify-content: center; 
      gap: 8px; 
      margin: 15px 0; 
    }
    .slot { 
      width: 70px; 
      height: 70px; 
      border: 1px solid #ccc; 
      border-radius: 8px; 
      display: flex; 
      justify-content: center; 
      align-items: center; 
      background: #fff; 
      position: relative;
      cursor: pointer;
    }
    .slot img { width: 60px; height: 60px; }

    .cancelX { 
      color: red; 
      font-size: 46px; 
      font-weight: bold; 
      position: absolute; 
      top: 0; 
      left: 0; 
      width: 100%; 
      height: 100%; 
      text-align: center; 
      line-height: 70px; 
      pointer-events: none; 
    }

    #smileFaces { display: flex; flex-wrap: wrap; justify-content: center; margin-top: 10px; }
    .smile { font-size: 50px; margin: 10px; cursor: pointer; position: relative; width: 60px; height: 60px; line-height: 60px; text-align: center; }
    .smileX { color: red; font-size: 55px; font-weight: bold; position: absolute; top: -5px; left: 0; width: 100%; height: 100%; text-align: center; line-height: 60px; pointer-events: none; }
  </style>
</head>
<body>
  <h1>ææ¥“å°ˆå±¬é›†é»å¡</h1>

  <div id="status">ç›®å‰æœ‰æ•ˆé»æ•¸ï¼š0 å€‹</div>

  <div class="points" id="pointsArea"></div>
  <div id="smileFaces"></div>

  <!-- å››å€‹è§’è‰²å¤§æŒ‰éˆ•ï¼š2x2 æ­£æ–¹å½¢ -->
  <div class="buttonGrid">
    <button class="charBtn">
      +1
      <img src="https://betsy32929.github.io/xifeng-card/æ³¢åŠ›.png" alt="æ³¢åŠ›">
    </button>
    <button class="charBtn">
      +1
      <img src="https://betsy32929.github.io/xifeng-card/å®‰å¯¶.png" alt="å®‰å¯¶">
    </button>
    <button class="charBtn">
      +1
      <img src="https://betsy32929.github.io/xifeng-card/ç¾…ä¼Š.png" alt="ç¾…ä¼Š">
    </button>
    <button class="charBtn">
      +1
      <img src="https://betsy32929.github.io/xifeng-card/èµ«åŠ›.png" alt="èµ«åŠ›">
    </button>
  </div>

  <button onclick="removePoint()" id="removePointBtn">-1 é»</button>
  <button onclick="redeemSmile()" id="redeemBtn">æ›ç¬‘è‡‰ ğŸ˜€</button>
  <button onclick="resetAll()" id="resetBtn">é‡ç½®å…¨éƒ¨</button>

  <script>
    let thumbs = JSON.parse(localStorage.getItem("thumbs")) || [];
    let smilesData = JSON.parse(localStorage.getItem("smiles")) || [];

    function saveData() {
      localStorage.setItem("thumbs", JSON.stringify(thumbs));
      localStorage.setItem("smiles", JSON.stringify(smilesData));
    }

    function updateDisplay() {
      const pointArea = document.getElementById("pointsArea");
      pointArea.innerHTML = "";

      const totalSlots = Math.ceil(thumbs.length / 5) * 5 || 5;

      for (let i = 0; i < totalSlots; i++) {
        const div = document.createElement("div");
        div.className = "slot";

        if (i < thumbs.length) {
          const img = document.createElement("img");
          img.src = thumbs[i].icon; 
          div.appendChild(img);

          if (thumbs[i].cancelled) {
            const xx = document.createElement("span");
            xx.textContent = "X";
            xx.className = "cancelX";
            div.appendChild(xx);
          }

          div.onclick = function() {
            if (!thumbs[i].cancelled) {
              if (confirm("è¦å–æ¶ˆé€™å€‹é»æ•¸å—ï¼Ÿ")) {
                thumbs[i].cancelled = true;
              }
            } else {
              if (confirm("è¦æ¢å¾©é€™å€‹é»æ•¸å—ï¼Ÿ")) {
                thumbs[i].cancelled = false;
              }
            }
            saveData();
            updateDisplay();
          };
        }

        pointArea.appendChild(div);
      }

      const validPoints = thumbs.filter(t => !t.cancelled).length;
      document.getElementById("status").textContent = `ç›®å‰æœ‰æ•ˆé»æ•¸ï¼š${validPoints} å€‹`;

      const smileContainer = document.getElementById("smileFaces");
      smileContainer.innerHTML = "";
      smilesData.forEach((smile, index) => {
        const span = document.createElement("span");
        span.className = "smile";
        span.textContent = "ğŸ˜€";

        if (smile.redeemed) {
          const xx = document.createElement("span");
          xx.textContent = "X";
          xx.className = "smileX";
          span.appendChild(xx);
        }

        span.onclick = function() {
          if (!smile.redeemed) {
            if (confirm("ç¢ºå®šè¦æ›´æ›å¯¦é«”ç¬‘è‡‰ï¼Ÿ")) {
              smilesData[index].redeemed = true;
            }
          } else {
            if (confirm("ç¢ºå®šè¦åˆªé™¤é€™å€‹ç¬‘è‡‰å—ï¼Ÿ")) {
              smilesData.splice(index, 1);
            }
          }
          saveData();
          updateDisplay();
        };
        smileContainer.appendChild(span);
      });
    }

    function addPoint(iconUrl) {
      thumbs.push({ cancelled: false, icon: iconUrl });
      saveData();
      updateDisplay();
    }

    // ç¶å®šè§’è‰²å¤§æŒ‰éˆ•
    document.querySelectorAll(".charBtn").forEach(btn => {
      btn.onclick = () => {
        const img = btn.querySelector("img");
        addPoint(img.src);
      };
    });

    function removePoint() {
      for (let i = thumbs.length - 1; i >= 0; i--) {
        if (!thumbs[i].cancelled) {
          thumbs[i].cancelled = true;
          break;
        }
      }
      saveData();
      updateDisplay();
    }

    function redeemSmile() {
      const validIndexes = thumbs
        .map((t, i) => (!t.cancelled ? i : -1))
        .filter(i => i >= 0);

      if (validIndexes.length >= 10) {
        for (let i = 0; i < 10; i++) {
          thumbs.splice(validIndexes[i] - i, 1);
        }
        smilesData.push({ redeemed: false });
        saveData();
        updateDisplay();
      } else {
        alert("éœ€è¦è‡³å°‘ 10 å€‹æœ‰æ•ˆé»æ•¸æ‰èƒ½å…Œæ›ç¬‘è‡‰ï¼");
      }
    }

    function resetAll() {
      if (confirm("ç¢ºå®šè¦é‡ç½®å—ï¼Ÿé»æ•¸èˆ‡ç¬‘è‡‰éƒ½æœƒæ­¸é›¶")) {
        thumbs = [];
        smilesData = [];
        saveData();
        updateDisplay();
      }
    }

    updateDisplay();
  </script>
</body>
</html>
